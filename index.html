<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel de Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family: Arial, sans-serif;
    background:#f2f2f2;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.container{
    background:#fff;
    width:100%;
    max-width:420px;
    padding:20px;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.2);
}
h2{text-align:center;}
input,button{
    width:100%;
    padding:10px;
    margin:5px 0;
}
button{
    background:#007bff;
    color:#fff;
    border:none;
    border-radius:5px;
}
.hidden{display:none;}
.card{
    border:1px solid #ddd;
    padding:10px;
    border-radius:8px;
    margin:8px 0;
}
.link{text-align:center;color:#007bff;cursor:pointer;}
</style>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  projectId: "SEU_PROJETO"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>
</head>

<body>
<div class="container">

<!-- LOGIN -->
<div id="loginBox">
<h2>Login</h2>
<input id="loginUser" placeholder="Usu치rio">
<input id="loginPass" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<div class="link" onclick="showRegister()">Criar conta</div>
</div>

<!-- REGISTRO -->
<div id="registerBox" class="hidden">
<h2>Criar Conta</h2>
<input id="regUser" placeholder="Usu치rio">
<input id="regPass" type="password" placeholder="Senha">
<button onclick="registerUser()">Cadastrar</button>
<div class="link" onclick="showLogin()">Voltar</div>
</div>

<!-- LOJA -->
<div id="shopBox" class="hidden">
<h2>Lojinha 游</h2>
<p id="welcomeUser"></p>
<p id="diamondInfo"></p>

<div class="card">
<b>Spotify Premium</b><br>
Pre칞o: <b>10 游눑</b><br><br>
<button onclick="buySpotify()">Comprar</button>
</div>

<button onclick="logout()">Sair</button>
</div>

<!-- ADMIN -->
<div id="adminBox" class="hidden">
<h2>Painel Admin</h2>
<div id="userList"></div>
<button onclick="logout()">Sair</button>
</div>

</div>

<script>
let currentUser = null;

function hideAll(){
  loginBox.classList.add('hidden');
  registerBox.classList.add('hidden');
  shopBox.classList.add('hidden');
  adminBox.classList.add('hidden');
}
function showLogin(){ hideAll(); loginBox.classList.remove('hidden'); }
function showRegister(){ hideAll(); registerBox.classList.remove('hidden'); }

// 游댏 CRIAR ADMIN AUTOM츼TICO
(async function(){
  const ref = db.collection('users').doc('admin');
  const snap = await ref.get();
  if(!snap.exists){
    await ref.set({
      user:'admin',
      pass:'123',
      role:'admin',
      diamonds:9999
    });
  }
})();

// REGISTRO
async function registerUser(){
  const u = regUser.value.trim();
  const p = regPass.value.trim();
  if(!u || !p) return alert('Preencha tudo');

  const ref = db.collection('users').doc(u);
  if((await ref.get()).exists) return alert('Usu치rio j치 existe');

  await ref.set({
    user:u,
    pass:p,
    role:'user',
    diamonds:0,
    expires: Date.now() + 86400000
  });

  // entra autom치tico
  currentUser = u;
  hideAll();
  shopBox.classList.remove('hidden');
  welcomeUser.innerText = 'Bem-vindo, ' + u;
  diamondInfo.innerText = 'Diamantes: 0';

  db.collection('users').doc(u).onSnapshot(d=>{
    diamondInfo.innerText = 'Diamantes: ' + d.data().diamonds;
  });
}

// LOGIN
async function login(){
  const u = loginUser.value.trim();
  const p = loginPass.value.trim();

  const ref = db.collection('users').doc(u);
  const snap = await ref.get();
  if(!snap.exists) return alert('Usu치rio n칚o existe');

  const user = snap.data();
  if(user.pass !== p) return alert('Senha errada');

  hideAll();

  if(user.role === 'admin'){
    adminBox.classList.remove('hidden');
    loadUsersRealtime();
  } else {
    currentUser = u;
    shopBox.classList.remove('hidden');
    welcomeUser.innerText = 'Bem-vindo, ' + u;
    diamondInfo.innerText = 'Diamantes: ' + user.diamonds;

    db.collection('users').doc(u).onSnapshot(d=>{
      diamondInfo.innerText = 'Diamantes: ' + d.data().diamonds;
    });
  }
}

// ADMIN REALTIME
function loadUsersRealtime(){
  db.collection('users').onSnapshot(snap=>{
    userList.innerHTML='';
    snap.forEach(doc=>{
      const u = doc.data();
      if(u.role === 'admin') return;

      const div = document.createElement('div');
      div.className='card';
      div.innerHTML=`
        <b>${u.user}</b><br>
        游눑 ${u.diamonds}<br>
        <input type="number" id="d_${u.user}">
        <button onclick="setDiamonds('${u.user}')">Definir</button>
        <button onclick="deleteUser('${u.user}')">Remover</button>
      `;
      userList.appendChild(div);
    });
  });
}

function setDiamonds(user){
  const v = document.getElementById('d_'+user).value;
  db.collection('users').doc(user).update({diamonds:parseInt(v)});
}

function deleteUser(user){
  db.collection('users').doc(user).delete();
}

async function buySpotify(){
  const ref = db.collection('users').doc(currentUser);
  const u = (await ref.get()).data();
  if(u.diamonds < 10) return alert('Sem diamantes');

  await ref.update({diamonds: u.diamonds - 10});
  window.open('https://www.mediafire.com/file/uo4tcd39wtiwkn2/Spotifypremium.apk/file','_blank');
}

function logout(){ showLogin(); }
</script>

</body>
</html>
